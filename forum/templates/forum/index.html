{% extends "forum\base.html" %}
{% block title %}Index of forum{% endblock %}
{% load filters %}
{% block head %}
    <style>
        .circle {
            border-radius: 100%;
            border: 0.22em solid black;
            height: 25px;
            width: 25px;
        }

        .glyphicon.glyphicon-chevron-up {
            font-size: 17px;
            padding-left: 1.6px;
        }

        .glyphicon.glyphicon-chevron-down {
            padding-left: 1.6px;
            padding-top: 2px;
            font-size: 17px;
        }

        .glyphicon.glyphicon-remove {
            padding-left: 1px;
            padding-top: 1px;
            font-size: 17px;
        }

        .submit-with-icon {
            background: transparent;
            border: 0px;
            padding: 0;
            outline: 0;
        }

        .circle:active {
            content: '';
            background-color: rgb(235, 235, 235);
            border-color: rgb(173, 173, 173);
        }
    </style>
{% endblock %}

{% block container-fluid %}

    <h1>Current subject: {{ topic_name }}</h1>
    {% if latest_questions_list %}
        <div class="panel-group" id="accordion">
            {% for q in latest_questions_list %}
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse{{ forloop.counter }}">
                                <div class="row">
                                    <div class="col-md-6">{{ q.question_name }}</div>
                                    <div class="col-md-3">Created: {{ q.question_created }}</div>
                                </div>
                            </a>
                        </h4>
                    </div>
                    <div id="collapse{{ forloop.counter }}" class="panel-collapse collapse">
                        <div class="panel-body">
                            <p>{{ q.question_text }}</p>

                            <div>
                                <form action="/forum/upvote/" method="post">
                                    {% csrf_token %}
                                    <div class="circle">
                                        <input type="hidden" value="{{ q.id }}" name="pk_question">
                                        <input type="hidden" value="{{ topic_name.id }}" name="topic">
                                        <button type="submit" class="submit-with-icon">
                                            <span class="glyphicon glyphicon-chevron-up"></span>
                                        </button>
                                    </div>
                                </form>
                                <label>{{ var|votes:q }}</label>
                                <form action="/forum/downvote/" method="post">
                                    {% csrf_token %}
                                    <div class="circle">
                                        <input type="hidden" value="{{ q.id }}" name="pk_question">
                                        <input type="hidden" value="{{ topic_name.id }}" name="topic">
                                        <button type="submit" class="submit-with-icon">
                                            <span class="glyphicon glyphicon-chevron-down"></span>
                                        </button>
                                    </div>
                                    {% if perms.forum.delete_question %}
                                        <form action="/forum/delete_question_in_index/" method="post">
                                            {% csrf_token %}
                                            <div class="circle">
                                                <input type="hidden" value="{{ q.id }}" name="pk_question">
                                                <input type="hidden" value="{{ topic_name.id }}" name="topic">
                                                <button type="submit" class="submit-with-icon">
                                                    <span class="glyphicon glyphicon-remove"></span>
                                                </button>
                                            </div>
                                        </form>
                                    {% endif %}
                                </form>
                            </div>
                            <p>{{ q.answers.answer_text }}</p>
                            <br>
                            {% for answer in answer_list %}
                                {% if answer.question_id == q.id %}
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <div class="row">
                                                <div class="col-md-6">{{ answer.get_user }}</div>
                                                <div class="col-md-6">Created: {{ answer.answer_created }}</div>
                                            </div>
                                        </div>
                                        <div class="panel-body">
                                            {{ answer.answer_text }}
                                        </div>
                                    </div>
                                    <br>
                                {% endif %}
                            {% endfor %}
                            <form class="new_question" action="/forum/new_answer/" method='post'>
                                {% csrf_token %}
                                {{ form.answer_text }}
                                <input type="hidden" value="{{ q.id }}" name="question">
                                {{ form.topic.as_hidden }}
                                <br><input type='submit' class="btn btn-default" value='Submit'/>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No questions are available.</p>
    {% endif %}
    <a class="btn btn-default" href="new_question" role="button">Create new question</a>
    <br>
    <br>

{% endblock %}

